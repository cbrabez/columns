<% include ../partials/header %>
  
  
  	<div class="content-wrapper">
			

  <div class="row">
      <div class="col-12">
         <h2 id="projectTitle"></h2>
         <ul class="list-group" id="taskList">
            <% tasksToProject.forEach(function(task){ %>
           <li class="list-group-item" draggable="true" data-id="<%= task.id %>"><%= task.title %>
              <span class="delete-task float-right"><a href="#"><i class="fas fa-times fa-lg"></i></a></span>
           </li>
            <% }); %>
         </ul>
      </div>
   </div>
   <div class="input-group task-entry">
      <input type="text" class="form-control task-input" placeholder="Title of new task" aria-label="Title of new task" aria-describedby="button-addon2">
      <div class="input-group-append add-btn">
        <button class="btn btn-outline-secondary" type="button" id="addTask">Add</button>
      </div>
   </div>
</div> <!-- .content-wrapper -->
</main><!-- .cd-main-content -->
<script>

$(function(){
   var url = window.location.pathname;
   var projectId = url.substring(url.lastIndexOf('/') + 1);
   $("ul").find("[data-id='" + projectId + "']").addClass("active");
   var project_title = $('.active').text();
   $("#projectTitle").html("Project   |  " + project_title);
});

$(".task-entry").on('keypress',function(e) {
   var task = $('.task-input').val();
   var url = window.location.pathname;
   var projectId = url.substring(url.lastIndexOf('/') + 1);
   if(e.which == 13) {
      addTask(task, projectId);
   }
});

$('button').click(function(e) {
   var task = $('.task-input').val();
   var url = window.location.pathname;
   var projectId = url.substring(url.lastIndexOf('/') + 1);
   console.log(projectId);
   addTask(task, projectId);
 });

// delete task on button click
   $(".delete-task").on('click', function(e){
      var id = $(this).parent().attr('data-id');
      deleteTask(id);
   });
   
 $('.project-list-item').click(function(e) {
   var projectId = $(this).attr('data-projectId');
   $.ajax({
         method: "GET",
         url: "/projects/" + projectId,
         success: function(result) {
             console.log(result);
             //location.reload(true);
         }
      });
 });
 
 // make task list sortable and save position of list-item in db
$("ul#taskList").sortable({
    pull: 'clone',
    animation: 150,
     onEnd: function (/**Event*/evt) {
		var itemEl = evt.item;  // dragged HTMLElement
		evt.to;    // target list
		evt.from;  // previous list
		var oldPosition = evt.oldIndex+1;  // element's old index within old parent
		var listPosition = evt.newIndex+1;  // element's new index within new parent
		var title = itemEl.innerHTML;
		var taskId = itemEl.getAttribute("data-id");
		$.ajax({
            method: "POST",
            url: "/tasks/" + taskId + "/?_method=PUT",
            data: {title: title, listPosition: listPosition, oldPosition: oldPosition},
            success: function(result) {
            }
        });
	},
});
</script>

<% include ../partials/footer %>